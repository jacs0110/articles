## 畢業專案回顧

在 [ALPHA Camp](https://tw.alphacamp.co/) 的全端 Web App 開發線上課程的[第四學期](https://tw.alphacamp.co/capstone-module)，也是整個課程的最後一個階段，需要和同學們共同完成一個專案，才能從這個學習之旅畢業。

以下將花一點篇幅來回顧一下畢業專案的過程

### 先聊聊隊友們

在這個學期的最一開始，其實就很快的跟兩位同學組成一隊，一路上共同完成各項作業與挑戰，才來到了最後一關畢業專案的挑戰。我覺得我們這一組的合作還蠻妙的，很少線上開會，即便有也不會開鏡頭，總是可以在很短的時間內結束，其實不太知道這樣算是「溝通效率高」還是「溝通內容過少」。

總之，我就還在摸索程式與不熟隊友的情況下，就變成了這次畢業專案的小組長。我們這一組中的三位成員，三位成員都有工作在身（聽說其他組好像都是全職學習的學生）。另外我們這組其中一位成員本身就是工程師。

***
### 如何決定主題

當初 AC 提供了三個畢業專案的主題，分別是 CRM 平台、電商平台、行程規劃工具，我們還蠻一致的投了電商平台一票，我想應該是大家對於電商比較有感覺。

但是要做怎麼樣的電商網站、要針對什麼客群、要解決什麼問題，其實我們並沒有什麼太多的想法（真的是剛毅木訥的一群人），因此我們決定，先把 AC 開出來的使用者故事給很快做完，之後也許可以特別針對管理者後台進行優化，像是報表、庫存管理等功能。

> 建議：下次開發前，還是需要鎖定問題才會更聚焦

但這時候我心裡也有另外一個想法：我們可能光是要做一個擁有最基本功能的電商網站都有困難跟挑戰了，如果這時候還去想太多其他事情，會不會就本末導致了呢？

雖然 ALPHA Camp 特別教了很多關於產品思維，但很可惜這次並沒有從最一開始就這樣思考。

> 建議：既然有教產品思維，就要拿出來用跟練習啊，不要浪費機會了！

***
### 如何分工

所以我們第一次討論的決定如下

1. Scope: 先以 AC 的使用者故事為主
2. 做前後分離 (Express + Vue)
3. 行有餘力的話
   * 強化管理者後台的管理功能
   * 寫測試

在分工方面，我們採自由認領的方式，主要切分幾大塊的工作項目
1. app 基礎建設: 架構最初的 express app 雛形，設定 Github 和 Heroku
2. 管理者功能與 api，包含使用者登入功能
3. 一般使用者功能與 api
4. 前端頁面

我主要負責一般使用者功能與 api，一位組員負責前端，另一位負責 app 基礎建設與管理者功能

兩位組員在開發時程中有安排出遊行程，因此我們暫定
* 開發的前三週完成 AC 的使用者故事
* 第四週到第六週強化管理者後台的功能，與測試

> 建議：事情總是不會像想像中的這麼順利，所以除了一開始透過鎖定問題來縮小產品 scope 之外，同時在開發的過程中也需要動態調整開發計畫

***
### 如何合作與管理
### 1. 文件管理

最一開始，我們把所有資訊（包含使用者故事、路由設計、第三方工具等）放在 Google sheet 上，不過後來就慢慢地移動回到 Github 的 Project 上

![Imgur](https://i.imgur.com/WXvuL3G.png)

Github Project 是一個非常類似 Trello 的看板管理系統，而由於是 Github 本身的功能，因此可以與 Github issue 連動。

以我們的 case 來說，我們開了四個 columns，分別為
1. Documents - 存放所有跟開發的相關文件
2. To Do
3. In Progress
4. Done

要怎麼加入卡片呢？除了在每一個欄位的最上面按 + 之外，我們主要的做法是在 Issues 開票，然後將這張票加入到 Project 裡面。來到 Issuse 頁面後，點擊右上方綠色的 "New issue"

![Imgur](https://i.imgur.com/LsKOZNF.png)

寫完 issue 的標題與內容之後，可以在右方選擇 Projects，然後會出現選單，這時候我們就可以選擇將這個 issue 放到哪個欄位當中

![Imgur](https://i.imgur.com/Z2meNQU.png)

另外 issue 這邊還有一個功能是 Labels，作為分類 issues 使用。我們主要使用
1. feature - 主要功能開發
2. bug - 需要被處理的問題
3. enhancement - 有會更好的東西

關於一些參數（config variables）像是那些會放在 .env 裡面的那些參數，我們就直接放在 Heroku 上面的 Settings 裡面，記得把隊友加入成為 collaborators，這樣每一位成員都可以進來看到最新版本的參數內容，也確保每一個人在 local 開發時候用的參數是一樣的

![Imgur](https://i.imgur.com/K7uqmUN.png)

當然如果有新開發的功能需要使用新參數，也請記得到 Heroku 這邊來同步新增

### 2. 流程管理

開發流程簡單介紹如下
1. 在 Issues 上面開票（新的使用者故事，或者是 bug 等等），並設定好
  *  Assignees
  *  Lables
  *  Projects（這樣一來這個新的 issue 就會同步出現在剛剛的 Project board 上面）
2. 各自在本地開新分支進行開發，完成 issues 上的功能，或解決問題
3. 將本地端的分支推上 remote origin
4. Create a new PR，在 PR 當中寫下完成的內容，並指定 reviewer（我們這一組是互相 review 彼此的程式碼，沒有特定的人專門來看）
5. 若 PR 有衝突，請發 PR 的組員主動排除，或是找組員們討論
6. 若 PR 無衝突，Reviewer 會進行檢查與測試，若有問題，會留下 comments；若沒有問題，就會 merge

我們有在 Heroku 上面設定自動部署，因此只要有 merge 的動作發生，就會同步部署到 Heroku 上面，讓我們可以很快的進行部署後的檢查。

另外，我們也有將 Github 與 Basecamp 串接，只要有新的 issue, push, PR 都會有提醒通知，部署完也會有通知，所以可以很即時的知道組員們的開發動態。

![Imgur](https://i.imgur.com/XC65i2p.png)

我想可能也是因為這樣，因此很少有需要上線討論的機會，有問題就會直接在 Github 上 tag 組員，或者在 basecamp 留言討論，問題通常很快就會被解決掉。

### 3. 開發相關工具

這裡也介紹一下開發過程中使用到的工具

#### [Fork](https://git-fork.com/)

Fork 是一個圖像化的版本管理工具，可以很快地看到分支與 commit 的狀態。我在上面沒有進行什麼操作，單純只是來確認狀況而已

![Imgur](https://i.imgur.com/mTtUAws.png)

#### [MySQLWorkbench](https://www.mysql.com/products/workbench/)

MySQLWorkbench 是一個圖像化的 MySQL database 操作工具，我覺得很好用，特別是在測試資料操作的時候，可以很快將資料設定成我想要的狀態，然後進一步做測試

![Imgur](https://i.imgur.com/VtXMdS0.png)

以上兩個工具 AC 都有教，很不錯

#### [pgAdmin](https://www.pgadmin.org/)

在 local 端我們可以透過 MySQLWorkbench 來操作資料庫，在 Heroku 上使用 PostgreSQL 時，也可以做到一樣的事情

請參與強者我組員的文章[【 Database 】透過 pgAdmin 操作 Heroku PostgreSQL 資料庫](https://learningsky.io/database-pgadmin-postgresql-heroku/)

操作方式其實和 MySQLWorkbench 非常類似，強力推薦使用！

![Imgur](https://i.imgur.com/qyD1EmR.png)

#### [Swagger](https://swagger.io/)

Swagger 是一個非常好用的 API 文檔工具與測試工具，只要寫好文檔（像是下面這樣）

![Imgur](https://i.imgur.com/3ZFXIlW.png)

啟動專案後，就會生成下面這樣的畫面

![Imgur](https://i.imgur.com/q0lq5s2.png)

直接透過圖形化介面操作並測試 API，比起用 Postman 更快更方便！這個也是強力推薦使用

網路上有蠻多相關的資訊，也可以直接用 npm 安裝

#### [Node-Red](https://nodered.org/)

Node-Red 是一套基於 flow programming 的開發工具，可以透過拖曳的方式建構程式流程，每一個結點就像是一個小 function，可以輸入/輸出資訊，也可以接受/發出 API。

這個工具其實我沒有很熟悉，主要是強者我隊友拿 Node-Red 來實現 Crontab 的功能，比寫程式碼方便多了！可以想像未來也可以很快速拿來的做各種測試。

![](https://oranwind.s3.amazonaws.com/2019/Oct/_____2019_10_14___10_40_52-1571064951132.png)

以上主要介紹「協助開發」的工具，至於其他用來建構 web app features 的第三方工具或套件，就不在這裡多做介紹。

***

### 開發上遇到的問題與挑戰
#### 1. 電商網站的商業邏輯問題

在開發初期，心裡其實就想著一個問題：到底要做一個電商網站，會遇到哪些問題？因此上網搜尋一下電商網站主要會遇到的問題，像是庫存管理、abandoned cart、推薦商品、流量管理等等問題，於是，我就先從庫存管理開始下手。

最重要的一個問題是：什麼時候要將庫存減一？技術上有幾種選擇
* 當使用者將商品加入購物車時，庫存就減一
* 當使用者成立訂單之後，庫存才減一
* 當使用者付費成功之後，庫存才減一

三種做法都有各自的優缺點，有可能是使用者在最一開始就發現商品無庫存、無法購買，不然就是進入結帳階段，發現庫存不足無法出貨。當然在這個問題上，不見得只能靠技術來解決，也是可以靠商業管理的方式來解決，譬如即便沒有庫存還是先成立訂單，之後再盡快補貨等等。

跟助教討論過後，決定先以「當使用者將商品加入購物車時，庫存就減一」來處理，同時使用者無法將無庫存的商品加入購物車。不過這時候就有衍伸出一些狀況，像是

* 如果使用者只是把商品加入購物車，但沒有成立訂單
* 若使用者成立訂單，但是未付款

在這樣的情況下，其實商品就會「卡住」，既沒有實際賣出，也沒有辦法讓新的使用者加入購物車。因此後續又加入了其他功能來解決這個問題，像是

* 系統定期清空未被更新的購物車，將商品加回庫存
* 系統定期清空被取消的訂單，將商品加回庫存

這樣一來，就可以確保使用者可以買到有庫存的商品、買不到無庫存的商品。（這沒有一定的正確做法，只是一個技術與商業上的選擇）

站在管理者的角度，就會看到一個商品的庫存量會隨時間上下飄動：被加入購物車的時候減少，被移出購物車的時候又加回來了。但對於管理者來說，又有另外一個問題：要怎麼紀錄商品實際賣出的量，以及商品補貨的量？

「庫存」是一個存量的概念，另外一個相對應的概念就是「流量」。存量只能反映當下的狀況，但是流量可以反映一段時間的狀況，譬如這個月總共進貨了多少商品、賣出的多少商品。

當初組員其實有提出會計帳的概念，但很可惜的最後我們並沒有投入實作。若要打造一個穩定、值得信任的購物網站，我認為最基本的庫存管理功能是需要被好好處理的

#### 2. Heap out of memory

當網站開發到一個階段的時候，我突然想到，若我們把加入 N 倍的種子資料，網站還能夠正常運作嗎？

於是我就加入了更多資料到資料庫當中，沒想到就出現了

```
FATAL ERROR: CALL_AND_RETRY_LAST Allocation failed - JavaScript heap out of memory
```

沒想到我寫的 web app 可以這麼脆弱，光是加入資料就讓它沒辦法正常運作。花了一段時間查資料，以及和助教討論過後，最後發現是使用 Sequelize 在 query 資料的時候，一口氣 include 太多的 model，導致資料表展開的時候用掉太多的資源。

這也讓我意識到，原來「取資料」這件事情，也是會影響到 app 的運作和效率。這件事衍伸出的問題有幾個：

* 要如何取出資料
* 要取出可以滿足使用者體驗的最小資料量是多少
* 什麼時候才需要拿資料

後來我只有根據第一個問題重構程式碼，並沒有進一步去處理其他問題，但我相信當資料規模大到某一種程度之後，就必須要去思考其他的問題

#### 3. MySQL v.s. PostgreSQL 

先前在設計資料欄位的時候犯了一個小錯誤：原本 datatype 要是 integer 的欄位，卻設定成 string。

在後續的資料處理上，雖然輸入的只有 0,1,2 這些數字，在 MySQL 上不會出錯，但是在PostgreSQL 就無法正常運作，不得不回頭修改 columns 的設定。

相較於 PostgreSQL， MySQL 相對寬鬆很多，所以在 local 端可以跑的程式，不見得在 Heroku 上的 postgres database 可以運作。

> 建議：本地端跟遠端使用同樣的資料庫進行開發

#### 4. 資料的連動關係

譬如以折扣券的設計來說，我們設計了
* Coupon table - 記錄每一張折扣券的細節資料，包含使用次數
* CouponDistribution table - 紀錄每一張折扣券的發送（使用者擁有）

當使用者要使用 coupon 的時候，需要去確認
1. 該使用者是否擁有該 coupon，該 coupon 是否已被使用（check CouponDistribution table）
2. 該 copuon 是否還沒有達到總使用次數的限制（check Coupon table）
3. 該 copuon 的內容（check Coupon table）

上面只是個例子，實際上有很多使用者故事，會需要同時確認許多資料表的內容，以及之間的關係。很多時候也是在寫程式碼寫到一半的時候，才發現其複雜性。

因此了解到，最初資料表的設計與關聯設計，其實會大大影響到後續開發。我們也曾經遇到過資料表設計錯誤的狀況，不得不在開發過程中，調整 tables 欄位

> 建議：在最初設計 ERD 的時候，需要更謹慎小心一點

***

### 如果有更多時間，在這個專案上會想要接下去做什麼？

在功能上，我會希望
* 根據使用者回饋，修正或更新產品功能
* 完成管理者後台的報表與其他商業邏輯相關功能

在程式方面，我會希望
* 重構程式碼，讓程式碼的風格一致，並加入充足的程式碼註解
* 加入測試

***
### 如果可以重來一次，可以怎麼樣做得更好

* 縮小專案的 scope
* 先寫下測試案例（不管只是文字敘述還是程式碼）
* 花更多時間先討論關於「使用者體驗」與「商業邏輯」的細節

### 心得

在這次的專案中，其實覺得身為組長的自己並沒有表現得很好，像是
* 沒有帶入產品思維，專注在特定的問題上，導致專案看起來沒有一個核心
* 沒有規劃好整個專案的 scope，導致後期一直在趕程式碼

最初的規劃沒有非常詳細，但過程中也算是讓組員們自由發揮，有機會接觸到 Vue 以及許多不同的第三方工具。雖然專案結果和當初預期差蠻多的，但我從組員們身上、從自己這六週的開發過程中學習了不少，收穫豐富。謝謝大家！

Github 也見證了我這段時間的學習

![Imgur](https://i.imgur.com/Ck8XCzT.png)
